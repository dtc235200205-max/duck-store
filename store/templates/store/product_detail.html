{% extends 'store/base.html' %}

{% block title %}{{ product.name }} - Duck Store{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-6">
        {% if product.image %}
        <img src="{{ product.image.url }}" class="img-fluid rounded" alt="{{ product.name }}" style="max-height: 500px; object-fit: cover;">
        {% else %}
        <div class="bg-secondary text-white d-flex align-items-center justify-content-center rounded" style="height: 500px;">
            <span><i class="fas fa-image me-2"></i>Không có hình ảnh</span>
        </div>
        {% endif %}
        {% if product.video %}
        <div class="mt-4">
            <h5><i class="fas fa-video me-2"></i>Video sản phẩm</h5>
            <video width="100%" height="350" controls class="rounded" style="background: #000;">
                <source src="{{ product.video.url }}" type="video/mp4">
                Trình duyệt của bạn không hỗ trợ video.
            </video>
        </div>
        {% endif %}
    </div>
    <div class="col-md-6">
        <h2 class="mb-3" style="font-weight: 800;">{{ product.name }}</h2>
        <p class="text-muted"><i class="fas fa-tag me-2"></i><strong>Danh mục:</strong> {{ product.category.name }}</p>
        <h3 class="text-danger mb-3" style="font-size: 2rem; font-weight: 700;"><i class="fas fa-money-bill-wave me-2"></i>{{ product.price }}K VNĐ</h3>
        
        <div class="alert alert-info mb-4">
            <i class="fas fa-truck me-2"></i><strong>Miễn phí vận chuyển</strong> cho đơn hàng từ 100K VNĐ
        </div>
        
        <p class="mt-3 fs-5" style="line-height: 1.8;">{{ product.description }}</p>
        
        {% if user.is_authenticated %}
        <div class="mt-5 d-flex gap-3 flex-column">
            <form action="{% url 'buy_now' product.id %}" method="post">
                {% csrf_token %}
                <button type="submit" class="btn btn-success btn-lg w-100">
                    <i class="fas fa-bolt me-2"></i>Mua ngay
                </button>
            </form>
            <a href="{% url 'add_to_cart' product.id %}" class="btn btn-outline-primary btn-lg">
                <i class="fas fa-cart-plus me-2"></i>Thêm vào giỏ hàng
            </a>
        </div>
        {% else %}
        <div class="alert alert-warning mt-4">
            <i class="fas fa-exclamation-circle me-2"></i>Vui lòng <a href="{% url 'login' %}" class="alert-link"><strong>đăng nhập</strong></a> để mua hàng.
        </div>
        {% endif %}
    </div>
</div>

<hr class="my-5">

<h4 class="mb-4"><i class="fas fa-comments me-2"></i>Bình luận sản phẩm</h4>
{% if user.is_authenticated %}
<div class="card mb-4" style="border-radius: 1.2rem;">
    <div class="card-body">
        <h5 class="card-title"><i class="fas fa-comment-dots me-2"></i>Để lại bình luận</h5>
        <form method="post">
            {% csrf_token %}
            <textarea name="comment" class="form-control" rows="3" placeholder="Chia sẻ trải nghiệm của bạn với sản phẩm này..."></textarea>
            <button type="submit" class="btn btn-primary mt-3"><i class="fas fa-paper-plane me-2"></i>Gửi bình luận</button>
        </form>
    </div>
</div>
{% else %}
<div class="alert alert-info mb-4">
    <i class="fas fa-info-circle me-2"></i>Vui lòng <a href="{% url 'login' %}" class="alert-link"><strong>đăng nhập</strong></a> để bình luận.
</div>
{% endif %}

<div class="comments-section">
    {% for comment in comments %}
    <div class="card mb-3" style="border-radius: 1rem; border-left: 4px solid var(--primary);">
        <div class="card-body">
            <h6 class="card-subtitle mb-2">
                <i class="fas fa-user-circle me-2"></i>
                <strong>{{ comment.user.username }}</strong>
            </h6>
            <p class="card-text">{{ comment.text }}</p>
            <small class="text-muted"><i class="fas fa-calendar me-1"></i>{{ comment.created_at|date:"d/m/Y - H:i" }}</small>
        </div>
    </div>
    {% empty %}
    <p class="text-muted text-center py-5">
        <i class="fas fa-comments" style="font-size: 3rem; opacity: 0.3;"></i><br>
        <strong>Chưa có bình luận</strong><br>
        Hãy là người đầu tiên chia sẻ cảm nhận!
    </p>
    {% endfor %}
</div>
{% endblock %}